// Generated by CoffeeScript 2.7.0
var CWD, checkCoffee, checkLatest, consola, exec, fs, isPackageLatest, path, pkg;

fs = require('fs');

path = require('path');

({exec} = require('child_process'));

consola = require('consola');

({isPackageLatest} = require('is-package-latest'));

({pkg, CWD} = require('./constants'));

// async
checkLatest = async function() {
  var res;
  try {
    res = (await isPackageLatest(pkg));
    if (res.success && !res.isLatest) {
      consola.box({
        title: 'A new version is now available!',
        message: `${res.currentVersion} --> \`${res.latestVersion}\`\n\n# global installation\n\`npm i -g milkee@latest\`\n# or local installation\n\`npm i -D milkee@latest\``
      });
      return true;
    } else {
      return false;
    }
  } catch (error1) {
    return false;
  }
};

checkCoffee = function() {
  var PKG_PATH, error, pkgData, pkgFile, ref, ref1;
  PKG_PATH = path.join(CWD, 'package.json');
  if (fs.existsSync(PKG_PATH)) {
    try {
      pkgFile = fs.readFileSync(PKG_PATH, 'utf-8');
      pkgData = JSON.parse(pkgFile);
      if (((ref = pkgData.dependencies) != null ? ref.coffeescript : void 0) || ((ref1 = pkgData.devDependencies) != null ? ref1.coffeescript : void 0)) {
        return;
      }
    } catch (error1) {
      error = error1;
      consola.warn(`Could not parse \`package.json\`: ${error.message}`);
    }
  }
  return exec('coffee --version', function(error) {
    if (error) {
      consola.warn('CoffeeScript is not found in local dependencies (`dependencies`, `devDependencies`) or globally.');
      return consola.info('Please install it via `npm install --save-dev coffeescript` to continue.');
    }
  });
};

module.exports = {checkLatest, checkCoffee};
